!function(e){function t(a){if(o[a])return o[a].exports;var n=o[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";var a=o(3);o(8),$(function(){(0,a.fillPopularImagesPanel)(),(0,a.initialize_map)()})},function(e,t){"use strict";function o(e){var t;return t="pop"==e?p+"/popular.json":u+"/"+e.replace(",","")+".json",$.getJSON(t).then(function(t){$.extend(c,t);var o=[];for(var a in t)o.push(a);return"pop"!=e&&(h[e]=l(t)),o})}function a(e){return c[e]||{title:"",date:"",library_url:""}}function n(e){var t=a(e),o=t.title;o&&(o+=" ");var n=t.date.replace(/n\.d\.?/,"No Date");return n||(n="No Date"),o+=n}function i(e){return"http://digitalcollections.nypl.org/items/image_id/"+e.replace(/-[a-z]$/,"")}function r(e){return e.replace("f","b").replace(/-[a-z]$/,"")}function s(e){return"http://images.nypl.org/?id="+r(e)+"&t=w"}function d(e){var t=h[e]||"";return t.replace(/: | - | & /g,"\n")}function l(e){for(var t in e){var o=e[t];if(o.original_title)return o.original_title}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadInfoForLatLon=o,t.infoForPhotoId=a,t.descriptionForPhotoId=n,t.libraryUrlForPhotoId=i,t.backId=r,t.backOfCardUrlForPhotoId=s,t.nameForLatLon=d;var c={},p="",u=p+"/by-location",h={}},function(e,t,o){"use strict";function a(){if(!$("#expanded").is(":visible"))return{};var e=$("#expanded").data("grid-key"),t=$("#grid-container").expandableGrid("selectedId");return t?{photo_id:t,g:e}:{g:e}}function n(e,t){var o=e.match(/(.*),g:(.*)/);if(o)t({photo_id:o[1],g:o[2]});else if("g:"==e.substr(0,2))t({g:e.substr(2)});else if(e.length>0){var a=e;s(a,function(o){t({photo_id:e,g:o})})}else t({})}function i(e){return e.photo_id?"pop"==e.g?e.photo_id+",g:pop":e.photo_id:e.g?"g:"+e.g:""}function r(e){var t=a();n(i(e),function(e){if(JSON.stringify(t)!=JSON.stringify(e)){if("{}"==JSON.stringify(e)&&((0,d.hideAbout)(),(0,d.hideExpanded)()),t.g!=e.g){var o=e.g,a=lat_lons[o];if("pop"==e.g)a=(0,d.getPopularPhotoIds)().length;else{var n=d.lat_lon_to_marker[o],i=(0,d.parseLatLon)(o);n||(n=(0,d.createMarker)(o,i)),n&&((0,d.selectMarker)(n,a),d.map.getBounds().contains(i)||d.map.panTo(i))}return void(0,l.loadInfoForLatLon)(o).done(function(t){(0,d.showExpanded)(e.g,t,e.photo_id)})}t.photo_id&&!e.photo_id?$("#grid-container").expandableGrid("deselect"):$("#grid-container").expandableGrid("select",e.photo_id)}})}function s(e,t){var o=e.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+o+".json",success:function(o){t(o[e])}})}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentStateObject=a,t.hashToStateObject=n,t.stateObjectToHash=i,t.transitionToStateObject=r,t.findLatLonForPhoto=s;var d=o(3),l=o(1)},function(e,t,o){"use strict";function a(e){return"http://oldnyc-assets.nypl.org/600px/"+e+".jpg"}function n(e){return"http://maps.googleapis.com/maps/api/staticmap?center="+e+"&zoom=15&size=150x150&maptype=roadmap&markers=color:red%7C"+e+"&style="+I.STATIC_MAP_STYLE}function i(e,t){var o=0;S&&(o=S.getZIndex(),S.setIcon(T)),e&&(S=e,T=e.getIcon(),e.setIcon(j[t>100?100:t]),e.setZIndex(1e5+o))}function r(e,t,o){i(t,lat_lons[e]),(0,_.loadInfoForLatLon)(e).done(function(t){var a=null;t.length<=10&&(a=t[0]),u(e,t,a),o&&a&&o(a)}).fail(function(){})}function s(e){var t=e.latLng.lat().toFixed(6)+","+e.latLng.lng().toFixed(6),o=O[t];r(t,o,function(e){$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",e)}),$(window).trigger("showGrid",t)}function d(){var e=new google.maps.LatLng(40.74421,-73.9737),o={zoom:15,maxZoom:18,minZoom:10,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!0,panControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:I.MAP_STYLE};t.map=G=new google.maps.Map($("#map").get(0),o);var a=$("<div/>").append($("<div/>").addClass("spacer")).get(0);a.index=-1,G.controls[google.maps.ControlPosition.TOP_LEFT].push(a);var n=G.getStreetView();google.maps.event.addListener(n,"visible_changed",function(){$(".streetview-hide").toggle(!n.getVisible())}),A.push(null),j.push(null);for(var i=0;100>i;i++){var r=i+1,s=1==r?9:13,d=1==r?15:21;A.push(new google.maps.MarkerImage("images/sprite-2014-08-29.png",new google.maps.Size(s,s),new google.maps.Point(i%10*39,39*Math.floor(i/10)),new google.maps.Point((s-1)/2,(s-1)/2))),j.push(new google.maps.MarkerImage("images/selected-2014-08-29.png",new google.maps.Size(d,d),new google.maps.Point(i%10*39,39*Math.floor(i/10)),new google.maps.Point((d-1)/2,(d-1)/2)))}var c=google.maps.event.addListener(G,"idle",function(){google.maps.event.removeListener(c),l(),D.resolve(G)});google.maps.event.addListener(G,"bounds_changed",function(){l()})}function l(){var e=G.getBounds();for(var t in lat_lons)if(!(t in O)){var o=c(t);e.contains(o)&&p(t,o)}}function c(e){var t=e.split(",");return new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1]))}function p(e,t){var o=lat_lons[e],a=new google.maps.Marker({position:t,map:G,flat:!0,visible:!0,icon:A[Math.min(o,100)],title:e});return B.push(a),O[e]=a,google.maps.event.addListener(a,"click",s),a}function u(e,t,o){x(),G.set("keyboardShortcuts",!1),$("#expanded").show().data("grid-key",e),$(".location").text((0,_.nameForLatLon)(e));var a=$.map(t,function(e){var t=(0,_.infoForPhotoId)(e);return $.extend({id:e,largesrc:t.image_url,src:t.thumb_url,width:600,height:400},t)});$("#preview-map").attr("src",n(e)),$("#grid-container").expandableGrid({rowHeight:200,speed:200},a),o&&$("#grid-container").expandableGrid("select",o)}function h(){$("#expanded").hide(),$(document).unbind("keyup"),G.set("keyboardShortcuts",!0)}function f(e,t){$(".description",t).html((0,_.descriptionForPhotoId)(e));var o=(0,_.infoForPhotoId)(e),a=(0,_.libraryUrlForPhotoId)(e);t.parent().find(".nypl-link a").attr("href",a),$(".nypl-logo a").attr("href",a);var n=(0,C.getCanonicalUrlForPhoto)(e);if((0,F.getFeedbackText)((0,_.backId)(e)).done(function(n){var i=n?n.text:o.text,r="/ocr.html#"+e,s=e.match("[0-9]f");if(i){var d=t.find(".text");d.text(i.replace(/\n*$/,"")),d.append($("<i>&nbsp; &nbsp; Typos? Help <a target=_blank href>fix them</a>.</i>")),d.find("a").attr("href",r)}else if(s){var l=t.find(".more-on-back");l.find("a.ocr-tool").attr("href",r),l.find("a.nypl").attr("href",a),l.show()}}),"undefined"!=typeof FB){var i=t.find(".comments"),r=i.parent().width();i.empty().append($('<fb:comments data-numposts="5" data-colorscheme="light"/>').attr("data-width",r).attr("data-href",n).attr("data-version","v2.3")),FB.XFBML.parse(i.get(0)),console.log(n)}var s=new ZeroClipboard(t.find(".copy-link"));if(s.on("ready",function(){s.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",window.location.href)}),s.on("aftercopy",function(e){var t=$(e.target);t.css({width:t.get(0).offsetWidth}).addClass("clicked").text("Copied!")})}),"undefined"!=typeof twttr&&twttr.widgets.createShareButton(document.location.href,t.find(".tweet").get(0),{count:"none",text:(o.original_title||o.title)+" - "+o.date,via:"Old_NYC @NYPL"}),"undefined"!=typeof FB){var d=t.find(".facebook-holder");d.empty().append($("<fb:like>").attr({href:n,layout:"button",action:"like",show_faces:"false",share:"true"})),FB.XFBML.parse(d.get(0))}t.off("mousewheel").on("mousewheel",function(e){var o=t.height(),a=t.get(0).scrollHeight,n=this.scrollTop===a-o&&e.deltaY<0||0===this.scrollTop&&e.deltaY>0;return!n})}function g(e){return $(e).attr("href").replace("/#","")}function v(){return $(".popular-photo:visible a").map(function(e,t){return g(t)}).toArray()}function m(e){var t="New York City",o=(0,M.findLatLonForPhoto)(e);o&&(t=o),$("#preview-map").attr("src",n(t))}function y(){var e=(new Date).getTime()-new Date("2015/12/15").getTime(),t=Math.floor(e/86400/1e3),o=t%L.popular_photos.length,n=L.popular_photos.slice(o).concat(L.popular_photos.slice(0,o)),i=function(e){var t=$("#popular-photo-template").clone().removeAttr("id");return t.find("a").attr("href","#"+e.id),t.find("img").attr("border","0").attr("data-src",a(e.id)).attr("height",e.height),t.find(".desc").text(e.desc),t.find(".loc").text(e.loc),e.date&&t.find(".date").text(" ("+e.date+")"),t.get(0)},r=$.map(n,i);$("#popular").append($(r).show()),$(r).appear({force_process:!0}),$("#popular").on("appear",".popular-photo",function(){var e=$(this).find("img[data-src]");w(e.get(0))})}function w(e){var t=$(e);t.attr("src")||$(e).attr("src",$(e).attr("data-src")).removeAttr("data-src")}function b(){$("#popular").hide(),$(".popular-link").show()}function k(){$("#popular").show(),$(".popular-link").hide(),$("#popular").appear({force_process:!0})}function P(){h(),$("#about-page").show();var e=$("#about-page .container"),t=e.width(),o=parseInt(e.css("max-width"),0);o>t&&e.css("margin-left","-"+t/2+"px")}function x(){$("#about-page").hide()}Object.defineProperty(t,"__esModule",{value:!0}),t.mapPromise=t.map=t.lat_lon_to_marker=void 0,t.selectMarker=i,t.initialize_map=d,t.parseLatLon=c,t.createMarker=p,t.showExpanded=u,t.hideExpanded=h,t.getPopularPhotoIds=v,t.fillPopularImagesPanel=y,t.showAbout=P,t.hideAbout=x;var S,T,_=o(1),I=o(5),C=o(7),F=o(4),L=o(6),M=o(2),B=[],A=[],O=t.lat_lon_to_marker={},j=[],G=t.map=void 0,D=t.mapPromise=$.Deferred();$.fn.scrollGuard=function(){return this.on("mousewheel",function(){var e=this.scrollHeight,t=$(this).height(),o=this.scrollTop===e-t&&event.deltaY<0||0===this.scrollTop&&event.deltaY>0;return!o})},$(function(){$(document).on("click","#expanded .curtains, #expanded .exit",function(){h(),$(window).trigger("hideGrid")}),$("#grid-container, #expanded .header").on("click",function(e){(e.target==this||$(e.target).is(".og-grid"))&&(h(),$(window).trigger("hideGrid"))}),$("#grid-container").on("og-fill","li",function(e,t){var o=$(this).data("image-id");$(t).empty().append($("#image-details-template").clone().removeAttr("id").show()),$(t).parent().find(".og-details-left").empty().append($("#image-details-left-template").clone().removeAttr("id").show()),f(o,$(t));var a=$("#expanded").data("grid-key");"pop"==a&&m(o)}).on("click",".og-fullimg > img",function(){var e=$("#grid-container").expandableGrid("selectedId");window.open((0,_.libraryUrlForPhotoId)(e),"_blank")}),$("#grid-container").on("click",".rotate-image-button",function(e){e.preventDefault();var t=$(this).closest("li").find(".og-fullimg > img"),o=t.data("rotate")||0;o+=90,t.css("transform","rotate("+o+"deg)").data("rotate",o);var a=$("#grid-container").expandableGrid("selectedId");ga("send","event","link","rotate",{page:"/#"+a+"("+o+")"}),(0,F.sendFeedback)(a,"rotate",{rotate:o,original:(0,_.infoForPhotoId)(a).rotation||null})}).on("click",".feedback-button",function(e){e.preventDefault(),$("#grid-container .details").fadeOut(),$("#grid-container .feedback").fadeIn()}).on("click","a.back",function(e){e.preventDefault(),$("#grid-container .feedback").fadeOut(),$("#grid-container .details").fadeIn()}),$(document).on("keyup","input, textarea",function(e){e.stopPropagation()}),$(".popular-photo").on("click","a",function(e){e.preventDefault();var t=g(this);(0,_.loadInfoForLatLon)("pop").done(function(e){u("pop",e,t),$(window).trigger("showGrid","pop"),$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",t)}).fail(function(){})}),$("#popular").on("scroll",function(){$(this).appear({force_process:!0})}),$("#popular .close").on("click",function(){(0,F.setCookie)("nopop","1"),b()}),$(".popular-link a").on("click",function(e){k(),(0,F.deleteCookie)("nopop"),e.preventDefault()}),document.cookie.indexOf("nopop=")>=0&&b(),$("#about a").on("click",function(e){e.preventDefault(),P()}),$("#about-page .curtains, #about-page .exit").on("click",x);var e=function(e){return function(){$(e).text("Thanks!")}};$("#grid-container").on("click",".feedback button[feedback]",function(){var t=$(this),o=!0;if(t.attr("feedback-param")){var a=t.siblings("input, textarea");if(o=a.val(),""==o)return;a.prop("disabled",!0)}t.prop("disabled",!0);var n=$("#grid-container").expandableGrid("selectedId"),i=t.attr("feedback"),r={};r[i]=o,(0,F.sendFeedback)(n,i,r).then(e(t.get(0)))}),$("#grid-container").on("og-select","li",function(){var e=$(this).data("image-id");$(window).trigger("showPhotoPreview",e)}).on("og-deselect",function(){$(window).trigger("closePreviewPanel")}).on("og-openpreview",function(){$(window).trigger("openPreviewPanel")})})},function(e,t){"use strict";function o(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function a(e,t){document.cookie=e+"="+t+"; path=/"}function n(e){var t;return t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)"),t?t.pop():""}function i(e,t,o){ga("send","event","link","feedback",{page:"/#"+e}),o.metadata={timestamp:Firebase.ServerValue.TIMESTAMP,user_agent:navigator.userAgent,user_ip:l?l.ip:"",location:l?l.location:"",cookie:p};var a="/feedback/"+e+"/"+t,n=d.child(a),i=$.Deferred();return n.push(o,function(e){e?(console.error("Error pushing",e),i.reject(e)):i.resolve()}),i}function r(e){var t=$.Deferred();return c.then(function(o){d.child("/feedback/"+e+"/text").orderByKey().once("value",function(e){var a=null;e.forEach(function(e){var t=e.val();t.metadata.timestamp>o&&(a=t)}),t.resolve(a)})}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCookie=o,t.setCookie=a,t.getCookie=n,t.sendFeedback=i,t.getFeedbackText=r;var s="oldnycid",d=null;"undefined"!=typeof Firebase&&(d=new Firebase("https://brilliant-heat-1088.firebaseio.com/"));var l=null;$.get("//ipinfo.io",function(e){l={ip:e.ip,location:e.country+"-"+e.region+"-"+e.city}},"jsonp");var c=$.get("/timestamps.json").then(function(e){return e.ocr_ms}),p=n(s);p||(p="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)}),a(s,p))},function(e,t){"use strict";function o(e){for(var t="",o=0;o<e.length;o++){var a=e[o],n=[];if(null!=a.featureType&&n.push("feature:"+a.featureType),null!=a.elementType&&n.push("element:"+a.elementType),null!=a.stylers)for(var i=0;i<a.stylers.length;i++)for(var r in a.stylers[i])n.push(r+":"+a.stylers[i][r].replace(/#/,"0x"));var s="&style="+n.join("%7C");t+=s}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=t.MAP_STYLE=[{stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"administrative",stylers:[{visibility:"simplified"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{color:"#cccccc"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road",elementType:"labels",stylers:[{color:"#94989C"},{visibility:"simplified"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];t.STATIC_MAP_STYLE=o(a)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.popular_photos=[{date:"1910",loc:"42nd & 5th ave",height:249,id:"708760f-a",desc:"Street scene"},{date:"1936",loc:"42nd & 5th ave",height:145,id:"1508783-a",desc:"Directing traffic and trolley"},{date:"1912",loc:"42nd & 5th ave",height:157,id:"708795f-a",desc:"Ground level view of street"},{date:"1913",loc:"42nd & 5th ave",height:159,id:"712987f-a",desc:"Street scene"},{date:"1928",loc:"42nd & 6th Avenue",height:246,id:"713050f-a",desc:"Street scene"},{date:"1933",loc:"42nd & 6th Avenue",height:130,id:"713043f",desc:"Under the elevated"},{date:"1939",loc:"42nd & 6th Avenue",height:159,id:"709480f-a",desc:"Elevated train demolition"},{date:"1930s",loc:"42nd & 6th Avenue",height:198,id:"1558013",desc:"Street scene"},{date:"1936",loc:"Central Park",height:160,id:"730166f-a",desc:"Aerial view"},{date:"1933",loc:"Central Park",height:133,id:"718268f-b",desc:"Roller skating"},{date:"1938",loc:"Central Park",height:229,id:"718346f-a",desc:"Feeding birds"},{date:"",loc:"Central Park",height:298,id:"718282f-a",desc:"On the lake"},{date:"",loc:"Central Park",height:160,id:"718194f-a",desc:"Riding under an arch"},{date:"1905",loc:"Central Park",height:154,id:"718242f-b",desc:"Ice skaters"},{date:"",loc:"Central Park",height:143,id:"718333f-a",desc:"Playing croquet"},{date:"",loc:"Central Park",height:132,id:"718280f-a",desc:"Quiet corner"},{date:"1892",loc:"Central Park",height:158,id:"718272f-a",desc:"Strolling"},{date:"1933",loc:"Central Park",height:133,id:"718179f-b",desc:"Aerial View"},{date:"1913",loc:"Central Park",height:130,id:"718284f",desc:"Schoolboys drilling"},{date:"1926",loc:"Prospect Park",height:172,id:"706346f-a",desc:"Prospect Park Plaza"},{date:"1880",loc:"Prospect Park",height:116,id:"706348f-b",desc:"Lake view"},{date:"1864",loc:"Central Park",height:168,id:"718385f-a",desc:"Rustic arbor"},{date:"1892",loc:"Central Park",height:164,id:"718262f-a",desc:"Fountain"},{date:"1933",loc:"Roosevelt Island",height:158,id:"732193f-a",desc:"Welfare (Roosevelt) Island"},{date:"1934",loc:"Brooklyn Bridge",height:134,id:"730718f-c",desc:"Aerial View"},{date:"1932",loc:"86th & 3rd",height:130,id:"714705f-a",desc:"Storefronts"},{date:"1926",loc:"Colonial & Nassau",height:154,id:"726358f-c",desc:"Family on porch"},{date:"1939",loc:"Duane & West",height:136,id:"719363f-a",desc:"Horse-drawn cart"},{date:"1929",loc:"Weehawken & Christopher",height:134,id:"724321f-b",desc:"Coca-Cola ad"},{date:"",loc:"George Washington Bridge",height:156,id:"1558509",desc:""},{date:"1906",loc:"Bayard & Chrystie",height:159,id:"716608f-a",desc:"Street scene"},{date:"1931",loc:"5th & 46th",height:159,id:"708851f-a",desc:"Street scene"},{date:"1933",loc:"Columbus Circle",height:155,id:"719145f-a",desc:"Tribute to Columbus"},{date:"1910",loc:"Pelham Parkway",height:146,id:"701498f-b",desc:"At the racetrack"},{date:"1936",loc:"9th & 40th",height:129,id:"732438f-b",desc:"Food vendors"},{date:"1911",loc:"Poppy Joe Island Beach",height:160,id:"730622f-a",desc:"Local muskrat hunters"},{date:"1890",loc:"Wallabout Bay",height:102,id:"734085f-a",desc:"Ship in port"},{date:"1933",loc:"Greenwich Village",height:299,id:"730568f-a",desc:"Art Exhibit"},{date:"1936",loc:"Battery Park",height:134,id:"716520f-c",desc:"Aerial view"},{date:"1921",loc:"New Chambers & Madison",height:141,id:"721912f-b",desc:"Cobblestone"},{date:"1918",loc:"5th & 25th",height:242,id:"731285f-a",desc:"Victory Arch"},{date:"1925",loc:"Minetta & MacDougal",height:168,id:"721650f-a",desc:"Alley"},{date:"1932",loc:"Canal & Chrystie",height:169,id:"718806f-a",desc:"Construction of Sarah Delano Roosevelt Park"},{date:"1933",loc:"Hudson Street",height:299,id:"733360f-c",desc:"Thanksgiving ragamuffins"},{date:"1917",loc:"Queensborough Bridge",height:157,id:"730942f-a",desc:"Construction"},{date:"1903",loc:"Williamsburg Bridge",height:129,id:"731081f",desc:"Under construction"},{date:"1890",loc:"Mott & Park",height:177,id:"721756f-a",desc:"Street scene"},{date:"1900",loc:"Broad St & Wall St",height:159,id:"716841f-a",desc:"Street scene"},{date:"1873",loc:"Brooklyn Bridge",height:153,id:"730663f-a",desc:"Under construction; view of Manhattan"},{date:"1879",loc:"Brooklyn Bridge",height:254,id:"730665f-a",desc:"Under construction; view of Manhattan"},{date:"1939",loc:"Coney Island",height:129,id:"731939f",desc:"Beach scene"},{date:"1922",loc:"Queens",height:152,id:"725900f-a",desc:"Country house (now JFK airport)"},{date:"1901",loc:"Broadway & 34th",height:156,id:"717404f-a",desc:"Street scene with muddy road"},{date:"1921",loc:"Broadway & 34th",height:158,id:"1558433",desc:"View of street scene from elevated tracks"}]},function(e,t){"use strict";function o(e){return"http://www.oldnyc.org/#"+e}function a(e){return $.get("https://graph.facebook.com/",{ids:$.map(e,function(e){return o(e)}).join(",")}).then(function(e){var t={};return $.each(e,function(e,o){t[e.replace(/.*#/,"")]=o.comments||0}),t})}Object.defineProperty(t,"__esModule",{value:!0}),t.getCanonicalUrlForPhoto=o,t.getCommentCount=a},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(){var e=location.pathname+location.search+location.hash;ga("send","pageview",{page:e})}var i=o(9),r=a(i),s=o(2),d=o(3),l=new r["default"](function(e,t){(0,s.hashToStateObject)(e.substr(1),t)}),c=!1;$(function(){var e=function(e){return"/#"+(0,s.stateObjectToHash)(e)},t=function(e){var t="Old NYC";return"photo_id"in e?t+" - Photo "+e.photo_id:"g"in e?t+" - Grid":t};$(window).on("showGrid",function(o,a){var i={g:a};l.pushState(i,t(i),e(i)),n()}).on("hideGrid",function(){var o={initial:!0};l.goBackUntil("initial",[o,t(o),e(o)])}).on("openPreviewPanel",function(){var o={photo_id:!0};l.pushState(o,t(o),e(o))}).on("showPhotoPreview",function(o,a){var i=$("#expanded").data("grid-key"),r={photo_id:a};"pop"==i&&(r.g="pop"),l.replaceState(r,t(r),e(r)),n()}).on("closePreviewPanel",function(){var o=$("#expanded").data("grid-key"),a={g:o};l.goBackUntil("g",[a,t(a),e(a)])}),$(l).on("setStateInResponseToUser setStateInResponseToPageLoad",function(e,t){(0,s.transitionToStateObject)(t)}),$(l).on("setStateInResponseToPageLoad",function(){n()}),c&&($(window).on("showGrid",function(e,t){console.log("showGrid",t)}).on("hideGrid",function(){console.log("hideGrid")}).on("showPhotoPreview",function(e,t){console.log("showPhotoPreview",t)}).on("closePreviewPanel",function(){console.log("closePreviewPanel")}).on("openPreviewPanel",function(){console.log("openPreviewPanel")}),$(l).on("setStateInResponseToUser",function(e,t){console.log("setStateInResponseToUser",t)}).on("setStateInResponseToPageLoad",function(e,t){console.log("setStateInResponseToPageLoad",t)})),d.mapPromise.done(function(){l.initialize()})})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){this.states=[],this.hashToStateAdapter=e};o.prototype.initialize=function(){var e=this;$(window).on("popstate",function(t){e.handlePopState(t.originalEvent.state)});var t={initial:!0},o=!1,a=function(){history.replaceState({},"",document.location.href),this.replaceState(t,document.title,document.location.href),o&&$(this).trigger("setStateInResponseToPageLoad",t)}.bind(this);this.hashToStateAdapter&&document.location.hash?(o=!0,this.hashToStateAdapter(document.location.hash,function(e){t=e,a()})):a()},o.prototype.makeState=function(e){var t=null;return history.state&&"id"in history.state&&(t=history.state.id),$.extend({length:history.length,previousStateId:t,id:Date.now()+""+Math.floor(1e8*Math.random())},e)},o.prototype.simplifyState=function(e){var t=$.extend({},e);return delete t.id,delete t.previousStateId,t},o.prototype.handlePopState=function(e){if(e&&"id"in e){var t=this.states[this.getStateIndexById(e.id)];if(t&&t.expectingBack)return void delete t.expectingBack}var o=function(){$(this).trigger("setStateInResponseToUser",e)}.bind(this);!e&&this.hashToStateAdapter?this.hashToStateAdapter(document.location.hash,function(t){e=t,o()}):o()},o.prototype.pushState=function(e,t,o){var a=this.makeState(e);this.states.push(a),history.pushState(a,t,o),document.title=t},o.prototype.replaceState=function(e,t,o){var a=this.getCurrentState(),n=null,i=null;a&&("id"in a&&(n=this.getStateIndexById(a.id)),"previousStateId"in a&&(i=a.previousStateId));var r=this.makeState(e);null!==i&&(r.previousStateId=i),null!==n?this.states[n]=r:this.states.push(r),history.replaceState(r,t,o),document.title=t},o.prototype.getCurrentState=function(){return history.state},o.prototype.getStateIndexById=function(e){for(var t=0;t<this.states.length;t++)if(this.states[t].id==e)return t;return null},o.prototype.getPreviousState=function(e){if(!("previousStateId"in e))return null;var t=e.previousStateId;if(null==t)return t;var o=this.getStateIndexById(t);if(null!==o)return this.states[o];throw"State out of whack!"},o.prototype.goBackUntil=function(e,t){if("string"==typeof e)return this.goBackUntil(function(t){return e in t},t);for(var o=this.getCurrentState(),a=0,n=null;o&&!e(o);)n=o,o=this.getPreviousState(o),a+=1;if(o&&a)return o.expectingBack=!0,history.go(-a),a;if(0==a)return 0;var i=a;1!=i&&(n.expectingBack=!0,history.go(-(i-1))),this.replaceState(t[0],t[1],t[2])},o.prototype.logStack=function(){for(var e=this.getCurrentState(),t=0;e;)console.log((t>0?"-":" ")+t,this.simplifyState(e)),e=this.getPreviousState(e),t++},t["default"]=o}]);